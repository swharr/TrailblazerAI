apiVersion: apps/v1
kind: Deployment
metadata:
  name: trailblazer-ai
spec:
  replicas: 1
  template:
    spec:
      # Tolerate spot node taint - required to schedule on spot
      tolerations:
        - key: "kubernetes.azure.com/scalesetpriority"
          operator: "Equal"
          value: "spot"
          effect: "NoSchedule"
      # Prefer spot nodes over system nodes
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
              - matchExpressions:
                  - key: kubernetes.azure.com/scalesetpriority
                    operator: In
                    values:
                      - spot
      # Grace period for eviction - allows clean shutdown
      terminationGracePeriodSeconds: 30
      containers:
        - name: trailblazer-ai
          resources:
            requests:
              cpu: "250m"
              memory: "512Mi"
            limits:
              cpu: "1000m"
              memory: "1Gi"
